# Info
This version uses Material design web component, becasue Fatzebra requires minimum or no specific JS framework dependencies other than jQuery.
https://material-components.github.io/material-components-web-catalog/#/component/text-field

The MDC uses es6/sass style morden web components standard with web pack as building system. The build out put is pure HTML/CSS/JS in asserts folder.

## Run
npm start

## Build
npm run build

## Changes
### folder structure
`assets`
application.css copied from original hosted web page
application.js copied from original hosted web page
card-mastercard/visa/transact-xxxx.svg copied from original hosted web page

Format card number into XXXX XXXX XXXX XXXX
```
var formatCardNumberForDisplay = function(cardNumber)
```

bundle.js generated by our new webpack build output
style-bundle.css generated by our new webpack build output

`js`

index.js material design web components entry point, es6 style

`scss`
style.scss new style, also included some old style overwrite
```
// Overwrite MDC default style
// Input text color
.mdc-text-field:not(.mdc-text-field--focused) {
  @include mdc-text-field-ink-color(#6e7396);
  @include mdc-text-field-label-color(#6e7396)
}
```

### Validation wire up
* Exisiting validation uses https://jqueryvalidation.org/documentation/

Customized validation method is added via below style in application.js, build output from Fatzebra's existing system
```
jQuery.validator.addMethod('card-type'
```

* Some input has Data mask plugin
https://github.com/digitalBush/jquery.maskedinput

The data mask place holder will cause conflict between MDC text field. Below code will set placeholder inside input, then the floating text is auto set.
```
<input
  type="text"
  class="expiry-date mdc-text-field__input"
  data-mask="99/999?9?"

jQuery('[data-mask]').each(function() {
    jQuery(this).mask(jQuery(this).data('mask'), {autoclear: false, placeholder: "MM/YYYY"});
  });
```
Remove the data-mask attribute and initiate mask when focusin
```
jQuery('#payment_request_expiry_date').on('focusin', function() {
  jQuery(this).mask('99/999?9?', {autoclear: false, placeholder: "MM/YYYY"});
});
```

* Add validation style

After customized validation invalid the element, we need to use to invalid/valid the input for MDC, then MDC component will add validation style on it.
```
ele.setCustomValidity("error");

jQuery('.mdc-card-holder').addClass('mdc-text-field--invalid')
```

e.g.
Expiry input has class="expiry-date", which will add a validation method in jQuery.Validator
```
jQuery.validator.addMethod('expiry-date', function(value, element) {
```

Inside that function, we will call removeErrorValidationStyleForExpiry(element) first
Then, depends on valid result to call addErrorValidationStyleForExpiry(element)

```
var isValid = validExp(parts[0], parts[1]);
  if (!isValid) {
    addErrorValidationStyleForExpiry(element);
  }

return true;
```

* To specify different error message for card number
```
switch (type)
  {
    case 'visa':
      jQuery('.mdc-card-number-icon__img')[0].src = '/assets/card-visa-5f8a240d56bca7d914a57f03c7a3be261cae8ee1ef43f444e181a4d1cb47a962.svg';
      break;
    case 'mastercard':
      jQuery('.mdc-card-number-icon__img')[0].src = '/assets/card-mastercard-48906597ac2007ce69cbe6d3a5928e801c83866376b8f881263872a9a978a6b8.svg';
      break
    default:
      addErrorValidationStyleForCard(this, 'This card type is not supported');
  }
```

* Below is the place where form validation rules get added in

The rule will get triggered when fields lost focus or during form.valid().
```
  jQuery("form").validate({
    ignore: ':hidden',
    rules: {
      'payment_request[card_holder]': {
        required: true,
        normalizer: function(value) {
          return $.trim(value);
        }
      },
      'payment_request[expiry_date]': {
        required: true,
        'expiry-date': true,
        normalizer: formatExpiryDate
      }
    },
```
 e.g.
 ```
showError   // called by field lost focus
card-number // called by customer validate method
card-holder // called by customer validate method
showError   // called again by form.valid()
 ```
